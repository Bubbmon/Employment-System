(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{"0120":function(t,e,s){},"0d14":function(t,e,s){},"1d5f":function(t,e,s){},"1dde":function(t,e,s){var n=s("d039"),i=s("b622"),o=s("2d00"),a=i("species");t.exports=function(t){return o>=51||!n((function(){var e=[],s=e.constructor={};return s[a]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},"1e29":function(t,e,s){"use strict";s("0d14")},"2c4f":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"whole"},[s("div",{staticClass:"logo",on:{click:t.backToHome}}),s("div",{staticClass:"self-center",staticStyle:{width:"150px",height:"100%",float:"right",display:"flex"}},[s("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":t.activeIndex,mode:"horizontal"},on:{select:t.handleSelect}},[s("el-submenu",{attrs:{index:"1"}},[s("template",{slot:"title"},[t._v("个人中心")]),s("el-menu-item",{attrs:{index:"selfcenter"},on:{select:t.handleSelect}},[t._v("账户信息")]),s("el-menu-item",{attrs:{index:"issueResume"},on:{select:t.handleSelect}},[t._v("发布招聘信息")]),s("el-menu-item",{attrs:{index:"recruimentList"},on:{select:t.handleSelect}},[t._v("查看已发布的信息")]),s("el-menu-item",{attrs:{index:"chatListHR"},on:{select:t.handleSelect}},[t._v("我的聊天")])],2)],1)],1)])},i=[],o={data:function(){return{activeIndex:"1"}},methods:{handleSelect:function(t){"selfcenter"==t?this.$router.push("/selfCenterHR"):"issueResume"==t?this.$router.push("/issueRecruimentInfo"):"recruimentList"==t?this.$router.push("/recruimentList"):"chatListHR"==t&&this.$router.push("/chatListHR")},backToHome:function(){this.$router.push("/searchHR")}}},a=o,r=(s("6a81"),s("2877")),c=Object(r["a"])(a,n,i,!1,null,"0dae64fc",null);e["a"]=c.exports},"437c":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("HeaderC"),s("ChatList")],1)},i=[],o=s("6e56"),a=s("5527"),r={components:{HeaderC:o["a"],ChatList:a["a"]}},c=r,l=(s("1e29"),s("2877")),u=Object(l["a"])(c,n,i,!1,null,"92230f02",null);e["default"]=u.exports},"4de4":function(t,e,s){"use strict";var n=s("23e7"),i=s("b727").filter,o=s("1dde"),a=o("filter");n({target:"Array",proto:!0,forced:!a},{filter:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},"52f0":function(t,e,s){},5381:function(t,e,s){"use strict";s("8d06")},5527:function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{background:"#f6f6f6"}},[s("div",{staticStyle:{display:"flex"}},[s("div",{staticClass:"list"},[s("h2",{staticStyle:{margin:"40px"}},[t._v("聊天记录")]),t._l(t.talkerList,(function(e,n){return s("div",{key:"talker"+n,staticClass:"item",on:{click:function(s){return t.chatWith(e)}}},[t._v(" "+t._s(e)+" ")])})),s("h2",{staticStyle:{margin:"40px"}},[t._v("未接收的消息")]),t._l(t.newMsg,(function(e,n){return s("div",{key:"newMsg"+n,staticClass:"item",on:{click:function(s){return t.historyChatWith(e)}}},[t._v(" "+t._s(e)+" ")])}))],2),s("div",{staticStyle:{width:"100%"}},[s("div",{staticClass:"chat",attrs:{id:"chat"}},t._l(t.chatContent,(function(e,n){return s("div",{key:"chat"+n,staticClass:"chat-item"},[s("div",{staticStyle:{"margin-right":"40px","background-color":"#e9e9e9",width:"100px","text-align":"center"}},[t._v(t._s(e.from))]),s("div",[t._v(t._s(e.message))])])})),0),s("div",{staticClass:"inputbox"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.newMessage,expression:"newMessage"}],attrs:{type:"text"},domProps:{value:t.newMessage},on:{input:function(e){e.target.composing||(t.newMessage=e.target.value)}}}),s("button",{on:{click:t.send}},[t._v("send")])])])])])},i=[],o=(s("4de4"),{components:{},data:function(){return{webSocketObj:null,talkerList:[],chatContent:[],newMsg:[],historyMsg:null,newMessage:null,talker:null,onlineTalker:null}},mounted:function(){this.getTalkers(),this.handleMsg(),this.talkFromDetail(),this.initWebSocket()},beforeDestroy:function(){this.over()},methods:{talkFromDetail:function(){var t=this;null!=this.$route.query.hrId&&setTimeout((function(){t.onlineTalker=t.$route.query.hrId,t.talker=t.onlineTalker;var e=!1,s=-1;for(var n in t.talkerList)if(t.talker==t.talkerList[n]){s=n,e=!0;break}e?t.chatWith(t.talkerList[s]):(t.talkerList.push(t.talker),t.chatWith(t.talker))}),100)},initWebSocket:function(){var t=this;this.webSocketObj=new WebSocket("ws://1.117.44.227:8088/employment/webSocket"),this.webSocketObj.onopen=this.onOpen,this.webSocketObj.onmessage=this.onMessage,this.webSocketObj.onerror=this.onError,this.webSocketObj.onclose=this.onClose,this.over=function(){t.webSocketObj.close()}},onOpen:function(){console.log("open"),this.wsHeartflag=!0,this.webSocketObj.send("#open#"+this.$store.state.token.value),this.reconnectTime=0},timingHeart:function(){var t=this;this.wsHeartflag&&this.webSocketObj.send("heartbeat-test"),this.wsHeart=setTimeout((function(){t.timingHeart()}),1e5)},onMessage:function(t){console.log(t.data);var e=JSON.parse(t.data);console.log(e),this.chatContent.push({from:e.id,message:e.message});var s=!1;for(var n in this.talkerList)e.id==this.talkerList[n]&&(s=!0);s||this.talkerList.push(e.id),this.onlineTalker=e.from,setTimeout((function(){var t=document.querySelector(".chat");t.scrollTop=t.scrollHeight}),100)},onError:function(){var t=this;clearTimeout(this.wsHeart),this.wsHeartflag=!1,this.reconnectTime<=5?setTimeout((function(){t.onOpen(),t.reconnectTime+=1}),5e3):(this.$toast("抱歉，暂时无法连接到聊天服务器，请稍后再试"),this.onClose())},onClose:function(){console.log("close"),this.webSocketObj.send("#close#"+this.$store.state.token.value),this.wsHeartflag=!1,this.webSocketObj&&this.webSocketObj.close&&this.webSocketObj.close()},getTalkers:function(){var t=this;this.$http({method:"get",url:"http://1.117.44.227:8088/employment/talk/whoTalkedWithMe",headers:{token:this.$store.state.token.value}}).then((function(e){t.talkerList=e.data.filter((function(e){return e!=t.$store.state.id.value}))}))},send:function(){var t=this;this.chatContent.push({from:this.$store.state.id.value,message:this.newMessage,to:this.talker}),this.newMessage=encodeURIComponent(this.newMessage),this.$http({method:"post",url:"http://1.117.44.227:8088/employment/talk/talkTo",headers:{token:this.$store.state.token.value,id:this.talker,message:this.newMessage}}).then((function(e){setTimeout((function(){var t=document.querySelector(".chat");t.scrollTop=t.scrollHeight}),100),t.newMessage="",console.log(e.data)}))},chatWith:function(t){var e=this;this.talker=t,this.$http({method:"get",url:"http://1.117.44.227:8088/employment/talk/history",headers:{token:this.$store.state.token.value,id:t}}).then((function(t){e.chatContent=t.data,setTimeout((function(){var t=document.querySelector(".chat");t.scrollTop=t.scrollHeight}),100)}))},historyChatWith:function(t){var e=this;this.talker=t,this.$http({method:"get",url:"http://1.117.44.227:8088/employment/talk/newFrom",headers:{token:this.$store.state.token.value,from:t}}).then((function(s){setTimeout((function(){var t=document.querySelector(".chat");t.scrollTop=t.scrollHeight}),100),e.historyMsg=s.data,e.chatContent=e.historyMsg,e.chatWith(t)}))},handleMsg:function(){var t=this;this.$http({method:"get",url:"http://1.117.44.227:8088/employment/talk/new",headers:{token:this.$store.state.token.value}}).then((function(e){t.newMsg=e.data.filter((function(e){return e!=t.$store.state.id.value}))}))}}}),a=o,r=(s("8b62"),s("2877")),c=Object(r["a"])(a,n,i,!1,null,"f66dcfda",null);e["a"]=c.exports},"56ce":function(t,e,s){"use strict";s("7b87")},"65f0":function(t,e,s){var n=s("861d"),i=s("e8b5"),o=s("b622"),a=o("species");t.exports=function(t,e){var s;return i(t)&&(s=t.constructor,"function"!=typeof s||s!==Array&&!i(s.prototype)?n(s)&&(s=s[a],null===s&&(s=void 0)):s=void 0),new(void 0===s?Array:s)(0===e?0:e)}},"6a81":function(t,e,s){"use strict";s("0120")},"6e56":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"whole",staticStyle:{width:"100%",height:"60px"}},[s("div",{staticClass:"logo",on:{click:t.backToHome}}),s("div",{staticClass:"self-center",staticStyle:{width:"150px",height:"100%",float:"right",display:"flex"}},[s("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":t.activeIndex,mode:"horizontal"},on:{select:t.handleSelect}},[s("el-submenu",{attrs:{index:"1"}},[s("template",{slot:"title"},[t._v("个人中心")]),s("el-menu-item",{attrs:{index:"/selfCenterC"},on:{select:t.handleSelect}},[t._v("账户信息")]),s("el-menu-item",{attrs:{index:"/selfResume"},on:{select:t.handleSelect}},[t._v("简历信息")]),s("el-menu-item",{attrs:{index:"/chatListC"},on:{select:t.handleSelect}},[t._v("我的聊天")])],2)],1)],1)])},i=[],o={data:function(){return{activeIndex:"1",key:""}},methods:{handleSelect:function(t){this.$router.push(t)},backToHome:function(){this.$router.push("/searchC")}}},a=o,r=(s("56ce"),s("2877")),c=Object(r["a"])(a,n,i,!1,null,"1888791a",null);e["a"]=c.exports},"7b87":function(t,e,s){},"8b62":function(t,e,s){"use strict";s("1d5f")},"8d06":function(t,e,s){},b727:function(t,e,s){var n=s("0366"),i=s("44ad"),o=s("7b0b"),a=s("50c4"),r=s("65f0"),c=[].push,l=function(t){var e=1==t,s=2==t,l=3==t,u=4==t,h=6==t,d=7==t,f=5==t||h;return function(m,v,p,k){for(var g,b,w=o(m),S=i(w),y=n(v,p,3),C=a(S.length),x=0,_=k||r,O=e?_(m,C):s||d?_(m,0):void 0;C>x;x++)if((f||x in S)&&(g=S[x],b=y(g,x,w),t))if(e)O[x]=b;else if(b)switch(t){case 3:return!0;case 5:return g;case 6:return x;case 2:c.call(O,g)}else switch(t){case 4:return!1;case 7:c.call(O,g)}return h?-1:l||u?u:O}};t.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterOut:l(7)}},dbc9:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"test"},[s("HeaderC"),s("div",{staticClass:"chatbox"},[s("div",{staticClass:"message"},t._l(t.messageList,(function(e,n){return s("div",{key:n,staticClass:"item"},[s("div",{staticStyle:{height:"30px"}},[s("span",{staticStyle:{width:"100px","text-align":"center","margin-right":"20px"}},[t._v(t._s(e.from)+" ")]),s("span",[t._v(t._s(e.msg))])])])})),0),s("div",{staticClass:"inputbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newMessage,expression:"newMessage"}],attrs:{type:"text"},domProps:{value:t.newMessage},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.send.apply(null,arguments)},input:function(e){e.target.composing||(t.newMessage=e.target.value)}}}),s("button",{on:{click:t.send}},[t._v("send")])])])],1)},i=[],o=s("6e56"),a={name:"test",components:{HeaderC:o["a"]},data:function(){return{webSocketObj:null,wsHeartflag:!1,reconnectTime:0,message:"",newMessage:"",messageList:[],talkerId:decodeURI(this.$route.query.hrId)}},created:function(){this.initWebSocket()},destroyed:function(){},methods:{send:function(){var t=this;this.messageList.push({from:this.$store.state.id.value,msg:this.newMessage}),this.newMessage=encodeURIComponent(this.newMessage),this.$http({method:"post",url:"http://1.117.44.227:8088/employment/talk/talkTo",headers:{token:this.$store.state.token.value,id:this.talkerId,message:this.newMessage}}).then((function(e){t.newMessage="",console.log(e.data)}))},initWebSocket:function(){this.webSocketObj=new WebSocket("ws://1.117.44.227:8088/employment/webSocket"),this.webSocketObj.onopen=this.onOpen,this.webSocketObj.onmessage=this.onMessage,this.webSocketObj.onerror=this.onError,this.webSocketObj.onclose=this.onClose},onOpen:function(){this.wsHeartflag=!0,this.webSocketObj.send("#open#"+this.$store.state.token.value),this.reconnectTime=0},timingHeart:function(){var t=this;this.wsHeartflag&&this.webSocketObj.send("heartbeat-test"),this.wsHeart=setTimeout((function(){t.timingHeart()}),1e5)},onMessage:function(t){console.log("message"+t.data),this.message=JSON.parse(t.data),this.messageList.push({from:this.message.id,msg:this.message.message})},onError:function(){var t=this;clearTimeout(this.wsHeart),this.wsHeartflag=!1,this.reconnectTime<=5?setTimeout((function(){t.onOpen(),t.reconnectTime+=1}),5e3):(this.$toast("抱歉，暂时无法连接到聊天服务器，请稍后再试"),this.onClose())},onClose:function(){this.webSocketObj.send("#close#"+this.$store.state.token.value),this.wsHeartflag=!1,this.webSocketObj&&this.webSocketObj.close&&this.webSocketObj.close()}}},r=a,c=(s("f209"),s("2877")),l=Object(c["a"])(r,n,i,!1,null,"3e806db1",null);e["default"]=l.exports},e8b5:function(t,e,s){var n=s("c6b6");t.exports=Array.isArray||function(t){return"Array"==n(t)}},eef9:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("HeaderHR"),s("ChatList")],1)},i=[],o=s("2c4f"),a=s("5527"),r={components:{HeaderHR:o["a"],ChatList:a["a"]}},c=r,l=(s("5381"),s("2877")),u=Object(l["a"])(c,n,i,!1,null,"78f2cead",null);e["default"]=u.exports},f209:function(t,e,s){"use strict";s("52f0")}}]);
//# sourceMappingURL=chat.e9f7bd05.js.map